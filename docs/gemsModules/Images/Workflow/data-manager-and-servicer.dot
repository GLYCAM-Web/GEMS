digraph {
    node [shape=box];
    compound=True;

    label="Single-entity, multiple-service workflow overview.";

    Receiver [label="Receiver\nInstantiates Transaction\nwith incoming JSON"];
   
    subgraph cluster_transaction_manager {
        label="Transaction manager";
        subgraph cluster_input_parser {
            label="Input Parser\nGenerates Service Tree &\nensures outgoing services list\nis complete and correct";
            Service_Tree_Maker [label="Service Tree Maker\n"];
            Data_Populator [label="Data Populator\nEnsures that each Service object\nhas all the data it needs"];
            Service_Serializer [label="Service Serializer\nEnsures that all Service objects\nare present in serial order\nin the outgoing Transaction."];
            { rank=same; Service_Tree_Maker -> Data_Populator; }  
            Service_Tree_Maker -> Service_Serializer ;
        }
        subgraph cluster_response_manager {
            label="Response Manager\nEnsures that response data is\ncomplete in the outgoing transaction";
            Response_Summarizer [label="Response Summarizer:\nGenerates response summaries &\npopulates user-friendly outputs."];
            Response_Serializer [label="Response Serializer\nEnsures that all Response objects\nare present in serial order."];

            Response_Summarizer -> Response_Serializer ;
        }
    }

    subgraph cluster_service_manager {
        label="Services manager";
        Main_Servicer [label="Main Servicer for all Services\nRuns each service in turn &\nStops progress if needed."];
        Service_Interface [label="Service Interface\nTranslates to and from\nneeds of the Service's\n business logic"];
        Service_Logic [label="Service Logic\nData IO for the\nService's business logic"];
        Response_Filler [label="Response Filler\nEnsures there is a response for\nany services that were not run."];

        Main_Servicer -> Service_Interface [label="Service Object  "];
        Main_Servicer -> Service_Interface [label="Response Object  " dir="back"];
        { rank=same; Main_Servicer -> Response_Filler ;}

        Service_Interface -> Service_Logic [label="JSON-agnostic inputs  "];
        Service_Interface -> Service_Logic [label="JSON-agnostic outputs  " dir="back"];
    }
    
    Receiver -> Service_Tree_Maker [label="Transaction object  " lhead=cluster_input_parser];
    Receiver -> Response_Summarizer [label="Outgoing JSON string  " dir="back" lhead=cluster_response_manager];
    
    Service_Serializer -> Main_Servicer [label="Service Tree Object  " ltail=cluster_input_parser];
    Response_Serializer -> Main_Servicer [label="Response Tree Object  " dir="back" ltail=cluster_response_manager];

}
